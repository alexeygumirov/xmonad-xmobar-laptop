#!/bin/bash
#
# ~/.xprofile
#
# Executed by startx (run your window manager from here)

setxkbmap us,ru,de -option -option 'grp:rshift_toggle,caps:ctrl_modifier'
xinput disable "SynPS/2 Synaptics TouchPad"
export QT_SCREEN_SCALE_FACTORS=1
export QT_SCALE_FACTOR=1
export QT_QPA_PLATFORMTHEME="qt5ct"

# maintenance of the ssh-agent
ssh-add -l &>/dev/null
if [ "$?" = "2" ]; then
  test -r ~/.ssh-agent && eval "$(<~/.ssh-agent)" >/dev/null
  ssh-add -l &>/dev/null
  if [ "$?" = "2" ]; then
    (umask 066; ssh-agent > ~/.ssh-agent)
    eval "$(<~/.ssh-agent)" >/dev/null
    ssh-add
  fi
fi

common_run(){
    /home/alexgum/.scripts/displaymode &
    [ -x /usr/bin/picom ] && (picom -f --experimental-backends 2> /dev/null &)
    [ -x /usr/bin/nitrogen ] && (nitrogen --restore &)
    [ -x /usr/lib/xfce4/notifyd/xfce4-notifyd ] && ([ -z $(pgrep notifyd) ] && /usr/lib/xfce4/notifyd/xfce4-notifyd >/dev/null 2>&1 &)
    [ -x /usr/bin/nm-applet ] && (nm-applet 2> /dev/null &)
    [ -x /usr/bin/volumeicon ] && (volumeicon 2> /dev/null &)
        [ -x /usr/bin/xfce4-clipman ] && (xfce4-clipman 2> /dev/null &)
    [ -x /usr/bin/blueman-tray ] && (blueman-applet 2> /dev/null &)
    if [ -x /usr/bin/xidlehook ]
    then
        [ ! -z $(pgrep xidlehook) ] && pkill xidlehook
        (xidlehook --timer 1800 '/home/alexgum/.scripts/lockscript notify' "" --timer 30 '/home/alexgum/.scripts/lockscript lock' "" &)
    fi
    [ -x /usr/bin/imwheel ] && imwheel
}

case $1 in
    xmonad)
        [ -x /usr/bin/trayer ] && (trayer --edge top --distance 2 --distancefrom right --align right --widthtype request --padding 6 --SetDockType true --SetPartialStrut true --expand true --monitor 0 --transparent true --alpha 0 --tint 0x1D3030 --height 20 2> /dev/null &)
        common_run
        ;;
    qtile)
        common_run
        ;;
esac
